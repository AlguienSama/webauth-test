<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test WebAuthn Mobile</title>
    <style>
        body { 
            font-family: system-ui, sans-serif; 
            margin: 20px; 
            line-height: 1.6;
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        .info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üß™ Test WebAuthn Mobile</h1>
    
    <div class="test-item info">
        <strong>Informaci√≥n del dispositivo:</strong><br>
        User Agent: <span id="userAgent"></span><br>
        Plataforma: <span id="platform"></span><br>
        T√°ctil: <span id="touch"></span>
    </div>

         <div class="test-item info">
         <strong>Capacidades WebAuthn:</strong><br>
         PublicKeyCredential: <span id="pkc"></span><br>
         isUserVerifyingPlatformAuthenticatorAvailable: <span id="uvpa"></span><br>
         isConditionalMediationAvailable: <span id="cma"></span>
     </div>
 
     <div class="test-item">
         <strong>Test de autenticador:</strong><br>
         <button onclick="testPlatformAuthenticator()">Probar autenticador de plataforma</button>
         <button onclick="testConditionalMediation()">Probar mediaci√≥n condicional</button>
         <button onclick="runAllTests()" style="background: #28a745;">üß™ Ejecutar todos los tests</button>
     </div>
     
     <div class="test-item info">
         <strong>üì± Informaci√≥n m√≥vil:</strong><br>
         <div id="mobile-info"></div>
     </div>

    <div id="results"></div>

    <script>
        // Mostrar informaci√≥n del dispositivo
        document.getElementById('userAgent').textContent = navigator.userAgent;
        document.getElementById('platform').textContent = navigator.platform;
        document.getElementById('touch').textContent = 'ontouchstart' in window ? 'S√≠' : 'No';

                 // Verificar capacidades WebAuthn
         document.getElementById('pkc').textContent = window.PublicKeyCredential ? 'S√≠' : 'No';
         document.getElementById('uvpa').textContent = window.PublicKeyCredential?.isUserVerifyingPlatformAuthenticatorAvailable ? 'S√≠' : 'No';
         document.getElementById('cma').textContent = window.PublicKeyCredential?.isConditionalMediationAvailable ? 'S√≠' : 'No';
         
         // Mostrar informaci√≥n m√≥vil
         const mobileInfo = document.getElementById('mobile-info');
         const mobileDetails = {
             userAgent: navigator.userAgent,
             platform: navigator.platform,
             touch: 'ontouchstart' in window ? 'S√≠' : 'No',
             maxTouchPoints: navigator.maxTouchPoints || 'No disponible',
             hardwareConcurrency: navigator.hardwareConcurrency || 'No disponible',
             deviceMemory: navigator.deviceMemory || 'No disponible',
             connection: navigator.connection ? navigator.connection.effectiveType : 'No disponible'
         };
         
         mobileInfo.innerHTML = `
             <div>User Agent: ${mobileDetails.userAgent.substring(0, 80)}...</div>
             <div>Plataforma: ${mobileDetails.platform}</div>
             <div>T√°ctil: ${mobileDetails.touch}</div>
             <div>Puntos t√°ctiles: ${mobileDetails.maxTouchPoints}</div>
             <div>N√∫cleos CPU: ${mobileDetails.hardwareConcurrency}</div>
             <div>Memoria: ${mobileDetails.deviceMemory} GB</div>
             <div>Conexi√≥n: ${mobileDetails.connection}</div>
         `;

        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            document.getElementById('results').prepend(div);
        }

        async function testPlatformAuthenticator() {
            try {
                if (!window.PublicKeyCredential?.isUserVerifyingPlatformAuthenticatorAvailable) {
                    addResult('‚ùå isUserVerifyingPlatformAuthenticatorAvailable no disponible', 'error');
                    return;
                }

                addResult('üîÑ Probando autenticador de plataforma...', 'info');
                const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
                
                if (available) {
                    addResult('‚úÖ Autenticador de plataforma disponible', 'success');
                } else {
                    addResult('‚ö†Ô∏è Autenticador de plataforma no disponible', 'warning');
                }
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function testConditionalMediation() {
            try {
                if (!window.PublicKeyCredential?.isConditionalMediationAvailable) {
                    addResult('‚ùå isConditionalMediationAvailable no disponible', 'error');
                    return;
                }

                addResult('üîÑ Probando mediaci√≥n condicional...', 'info');
                const available = await PublicKeyCredential.isConditionalMediationAvailable();
                
                if (available) {
                    addResult('‚úÖ Mediaci√≥n condicional disponible', 'success');
                } else {
                    addResult('‚ö†Ô∏è Mediaci√≥n condicional no disponible', 'warning');
                }
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }

                 // Funci√≥n para ejecutar todos los tests
         async function runAllTests() {
             addResult('üß™ Ejecutando suite completa de tests...', 'info');
             
             // Test 1: Basic WebAuthn support
             addResult('Test 1: Verificando soporte WebAuthn b√°sico...', 'info');
             if (!window.PublicKeyCredential) {
                 addResult('‚ùå Test 1 fall√≥: WebAuthn no soportado', 'error');
             } else {
                 addResult('‚úÖ Test 1 pasado: WebAuthn soportado', 'success');
             }
             
             // Test 2: Platform authenticator
             addResult('Test 2: Verificando autenticador de plataforma...', 'info');
             if (!window.PublicKeyCredential?.isUserVerifyingPlatformAuthenticatorAvailable) {
                 addResult('‚ùå Test 2 fall√≥: Autenticador de plataforma no disponible', 'error');
             } else {
                 addResult('‚úÖ Test 2 pasado: Autenticador de plataforma disponible', 'success');
             }
             
             // Test 3: Conditional mediation
             addResult('Test 3: Verificando mediaci√≥n condicional...', 'info');
             if (!window.PublicKeyCredential?.isConditionalMediationAvailable) {
                 addResult('‚ö†Ô∏è Test 3: Mediaci√≥n condicional no soportada', 'warning');
             } else {
                 addResult('‚úÖ Test 3 pasado: Mediaci√≥n condicional soportada', 'success');
             }
             
             // Test 4: Touch support
             addResult('Test 4: Verificando soporte t√°ctil...', 'info');
             if ('ontouchstart' in window) {
                 addResult('‚úÖ Test 4 pasado: Soporte t√°ctil disponible', 'success');
             } else {
                 addResult('‚ö†Ô∏è Test 4: Soporte t√°ctil no disponible', 'warning');
             }
             
             // Test 5: Mobile indicators
             addResult('Test 5: Verificando indicadores m√≥viles...', 'info');
             const mobileIndicators = {
                 maxTouchPoints: navigator.maxTouchPoints > 0,
                 hardwareConcurrency: navigator.hardwareConcurrency > 0,
                 deviceMemory: navigator.deviceMemory > 0
             };
             
             if (mobileIndicators.maxTouchPoints || mobileIndicators.hardwareConcurrency || mobileIndicators.deviceMemory) {
                 addResult('‚úÖ Test 5 pasado: Indicadores m√≥viles detectados', 'success');
             } else {
                 addResult('‚ö†Ô∏è Test 5: Pocos indicadores m√≥viles detectados', 'warning');
             }
             
             addResult('üéâ Suite de tests completada!', 'success');
         }
         
         // Auto-test al cargar
         window.addEventListener('load', () => {
             addResult('üöÄ P√°gina cargada, ejecutando tests autom√°ticos...', 'info');
             setTimeout(() => {
                 testPlatformAuthenticator();
                 testConditionalMediation();
             }, 1000);
         });
    </script>
</body>
</html>
